# Курсовая работа на профессии "DevOps-инженер с нуля"
## Исполнитель: Файзиев Давлат

Текст курсовой находится по [ссылке](https://github.com/netology-code/fops-sysadm-diplom/blob/diplom-zabbix/README.md).

Для развертывания и конфигурации инфраструктуры используется Terraform и Ansible.
Проект курсовой работы состоит из двух папок:
- terraform (содержит манифесты для развертывания и резервного копирования инфраструктуры);
- ansible (содержит плейбуки для конфигурации инфраструктуры).

### Развертывание инфраструктуры:

До начала запуска необходимо создать yandex_cloud_token.
Прописать токен в качестве переменной в файле terraform.tfvars. Файл разместить в папке terraform.  
Далее из папки terraform выполнить команды:
```sh
terraform init
terraform apply -target=module.vpc_up --auto-approve
```

#### Результат работы команды:

![Скриншот 1](img/1.png)

![Скриншот 2](img/2.png)

![Скриншот 3](img/3.png)

![Скриншот 4](img/4.png)

### Настраиваем Elasticsearch и Kibana:

1. Редактируем файл inventory.ini.  
Необходимо в разделе all:vars прописать внешние ip-адреса для bastion и zabbix, полученные при запуске манифеста terraform:

![Скриншот 5](img/5.png)

2. Запускаем плейбук 1_conf_elk.yml из директории ansible.
```sh
ansible-playbook 1_conf_elk.yml 
```
В результате работы плейбука будет настроено:
- сервер elasticsearch
- сервер kibana
- связь между ними

#### Результат работы команды:

![Скриншот 6](img/6.png)

### Настраиваем вебсервера:

Запускаем плейбук 2_conf_web.yml из директории ansible.
```sh
ansible-playbook 2_conf_web.yml
```
В результате работы плейбука будет настроено:
- веб сервер nginx
- веб страница index.html
- filebeat на отправку access.log, error.log nginx

#### Результат работы команды:

![Скриншот 7](img/7.png)

### Настраиваем сервер Zabbix и zabbix agent:

Запускаем плейбук 3_conf_zabbix.yml из директории ansible.
```sh
ansible-playbook 3_conf_zabbix.yml
```
В результате работы плейбука будет настроено:
- сервер Zabbix
- установлен zabbix agent на вебсервера

#### Результат работы команды:

![Скриншот 8](img/8.png)
![Скриншот 9](img/9.png)

#### Проверяем инфраструктуру:
Проверяем балансировщик и доступность сайта:

![Скриншот 10](img/10.png)

Проверяем поступление логов на kibana:

![Скриншот 11](img/11.png)

Настраиваем Zabbix:
 